# name: GitHub Classroom Workflow

# on: [push]

# permissions:
#   checks: write
#   actions: read
#   contents: read

# jobs:
#   build:
#     name: Autograding
#     runs-on: ubuntu-latest
#     steps:
#     - name: Clean up disk space
#       run: sudo rm -rf "/opt/ghc" && sudo rm -rf "/usr/local/share/boost" && sudo rm -rf $AGENT_TOOLSDIRECTORY
#     - name: Set up OpenJDK 17
#       uses: actions/setup-java@v3
#       with:
#         distribution: 'temurin'
#         java-version: '17'
#     - name: Set up Maven
#       uses: stCarolas/setup-maven@v4.5
#       with:
#         maven-version: 3.9.5
#     - name: Checkout
#       uses: actions/checkout@v4
#     - uses: education/autograding@v1

#PREVIOUS WORKING WORKFLOW 

# name: GitHub Classroom Workflow

# on: [push]

# permissions:
#   checks: write
#   actions: read
#   contents: read

# jobs:
#   build:
#     name: Autograding
#     runs-on: ubuntu-latest
#     steps:
#       - name: Clean up disk space
#         run: sudo rm -rf "/opt/ghc" && sudo rm -rf "/usr/local/share/boost" && sudo rm -rf $AGENT_TOOLSDIRECTORY

#       - name: Set up OpenJDK 17
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '17'

#       - name: Set up Maven
#         uses: stCarolas/setup-maven@v4.5
#         with:
#           maven-version: 3.9.5

#       - name: Checkout
#         uses: actions/checkout@v4

#       # Step 1: Run the autograder (this will generate feedback)
#       - uses: education/autograding@v1

#       # Step 2: Make the parse script executable
#       - name: Make the parse script executable
#         run: chmod +x ./scripts/parse_and_link_feedback.sh   # This step ensures the script is executable

#       # Step 3: Run the parse and link feedback script
#       - name: Run the parse and link feedback script
#         run: ./scripts/parse_and_link_feedback.sh   # Executes the script


name: GitHub Classroom Workflow

on: [push]

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  build:
    name: Autograding
    runs-on: ubuntu-latest

    steps:
      - name: Clean up disk space
        run: sudo rm -rf "/opt/ghc" && sudo rm -rf "/usr/local/share/boost" && sudo rm -rf $AGENT_TOOLSDIRECTORY

      - name: Set up OpenJDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Set up Maven
        uses: stCarolas/setup-maven@v4.5
        with:
          maven-version: 3.9.5

      - name: Checkout
        uses: actions/checkout@v4

      # Run the Autograder (This is the same as before)
      - uses: education/autograding@v1

      # Debug: Check what files exist after the autograder
      - name: Debug - List workspace files
        run: ls -R "$GITHUB_WORKSPACE"

      # Find the correct feedback file and store it in test_results.log
      - name: Capture Autograder Output
        run: |
          if [ -f "$GITHUB_WORKSPACE/feedback.json" ]; then
             echo "✅ feedback.json found!"
             cat "$GITHUB_WORKSPACE/feedback.json" > test_results.log
          elif [ -f "$GITHUB_WORKSPACE/autograding-results.json" ]; then
             echo "✅ autograding-results.json found!"
             cat "$GITHUB_WORKSPACE/autograding-results.json" > test_results.log
          else
             echo "❌ No feedback file found! Exiting."
             exit 1
          fi

  # Upload Grader Output Logs
      - name: Upload Grader Output Logs
        uses: actions/upload-artifact@v4
        with:
          name: grader-output-logs
          path: test_results.log

