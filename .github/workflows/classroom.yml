# name: GitHub Classroom Workflow

# on: [push]

# permissions:
#   checks: write
#   actions: read
#   contents: read

# jobs:
#   build:
#     name: Autograding
#     runs-on: ubuntu-latest
#     steps:
#     - name: Clean up disk space
#       run: sudo rm -rf "/opt/ghc" && sudo rm -rf "/usr/local/share/boost" && sudo rm -rf $AGENT_TOOLSDIRECTORY
#     - name: Set up OpenJDK 17
#       uses: actions/setup-java@v3
#       with:
#         distribution: 'temurin'
#         java-version: '17'
#     - name: Set up Maven
#       uses: stCarolas/setup-maven@v4.5
#       with:
#         maven-version: 3.9.5
#     - name: Checkout
#       uses: actions/checkout@v4
#     - uses: education/autograding@v1

#PREVIOUS WORKING WORKFLOW 

# name: GitHub Classroom Workflow

# on: [push]

# permissions:
#   checks: write
#   actions: read
#   contents: read

# jobs:
#   build:
#     name: Autograding
#     runs-on: ubuntu-latest
#     steps:
#       - name: Clean up disk space
#         run: sudo rm -rf "/opt/ghc" && sudo rm -rf "/usr/local/share/boost" && sudo rm -rf $AGENT_TOOLSDIRECTORY

#       - name: Set up OpenJDK 17
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '17'

#       - name: Set up Maven
#         uses: stCarolas/setup-maven@v4.5
#         with:
#           maven-version: 3.9.5

#       - name: Checkout
#         uses: actions/checkout@v4

#       # Step 1: Run the autograder (this will generate feedback)
#       - uses: education/autograding@v1

#       # Step 2: Make the parse script executable
#       - name: Make the parse script executable
#         run: chmod +x ./scripts/parse_and_link_feedback.sh   # This step ensures the script is executable

#       # Step 3: Run the parse and link feedback script
#       - name: Run the parse and link feedback script
#         run: ./scripts/parse_and_link_feedback.sh   # Executes the script


name: GitHub Classroom Workflow

on: [push]

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  build:
    name: Autograding
    runs-on: ubuntu-latest
    steps:
      # 1️⃣ Clean up disk space
      - name: Clean up disk space
        run: sudo rm -rf "/opt/ghc" "/usr/local/share/boost" "$AGENT_TOOLSDIRECTORY"
      
      # 2️⃣ Set up Java 17
      - name: Set up OpenJDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 3️⃣ Set up Maven
      - name: Set up Maven
        uses: stCarolas/setup-maven@v4.5
        with:
          maven-version: 3.9.5

      # 4️⃣ Checkout repository
      - name: Checkout
        uses: actions/checkout@v4

      # 5️⃣ Run the autograder and save its output
      - name: Run Autograder
        run: |
          education/autograding@v1 | tee autograder_output.txt
        continue-on-error: true  # Ensure the workflow doesn't fail even if tests fail

      # 6️⃣ Upload the autograder output as an artifact
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: autograder-results
          path: autograder_output.txt
